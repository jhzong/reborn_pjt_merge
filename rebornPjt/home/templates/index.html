{% extends "base.html" %}
{% block css %}
<link rel='stylesheet' href="/static/css/restaurants.css">
<link rel='stylesheet' href="/static/css/home.css">
<style>
/* HEADER */
/*.r_header {
    background: #fff;
    padding: 20px;
    border-bottom: 1px solid #eee;
}

.r_logo {
    font-size: 24px;
    margin-bottom: 15px;
}

.r_search-box {
    display: flex;
    gap: 10px;
}

.r_search-box input {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ddd;
}

.r_search-box button {
    padding: 12px 20px;
    border-radius: 8px;
    border: none;
    background: #111;
    color: #fff;
}*/
.r_search-box {
    position: relative; /* ìì‹ ìš”ì†Œì¸ ì•„ì´ì½˜ì˜ ê¸°ì¤€ì ì´ ë©ë‹ˆë‹¤ */
}

.r_search-box button{
    cursor: pointer;
}

/* 2. ì•„ì´ì½˜ ìœ„ì¹˜ ìµœì í™” */
.filter-icon-button {
    position: absolute;
    /* ë²„íŠ¼(ê²€ìƒ‰) ë„ˆë¹„ì™€ ê°„ê²©ì„ ê³ ë ¤í•˜ì—¬ ì˜¤ë¥¸ìª½ì—ì„œ ë„ì›€ */
    /* ë³´í†µ ê²€ìƒ‰ ë²„íŠ¼ì˜ ë„ˆë¹„ê°€ 70~80pxì´ë¯€ë¡œ ê·¸ ì•ì— ìœ„ì¹˜ì‹œí‚µë‹ˆë‹¤ */
    right: 85px; 
    top: 50%; /* ì •í™•íˆ ì„¸ë¡œ ì¤‘ì•™ */
    transform: translateY(-50%); /* ì •í™•íˆ ì„¸ë¡œ ì¤‘ì•™ */
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
    z-index: 10;
    display: flex; /* ì•„ì´ì½˜ ì´ë¯¸ì§€ ì •ë ¬ */
    align-items: center;
}

.filter-icon-button img {
    width: 24px;
    height: 24px;
}

/* 3. ì…ë ¥ì°½ì´ ì•„ì´ì½˜ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ ì—¬ë°± ì£¼ê¸° */
.r_search-box input {
    flex: 1;
    padding: 12px;
    padding-right: 45px; /* ì•„ì´ì½˜ì´ ë“¤ì–´ê°ˆ ê³µê°„ í™•ë³´ (ì¤‘ìš”) */
    border-radius: 8px;
    border: 1px solid #ddd;
}
</style>
{% endblock css %}
{% block script %}
<script>
    function searchData() {
        let url = "/restaurants/reslist";
        location.href = url+"?"+frm;
        //location.href = url+"?"+encodeURIComponent(frm);
        /*$.ajax({
            url:url,
            type: 'GET',
            dataType:'json',
            data:$("#searchFrm").serialize(),
            success: function(data) {
                location.href="/restaurants/rlist";
            },
            error: function(xhr, errMsg, err) {
                //console.error("ì„œë²„ ì—ëŸ¬ : ", errMsg);
                alert("ì„œë²„ì—ëŸ¬");
            }
        });*/
    }

    document.addEventListener('DOMContentLoaded', () => {
        // ì§€ì—­ ìŠ¬ë¼ì´ë“œ
        const sliderTrack = document.querySelector('.slider-track');
        const prevBtn = document.querySelector('.slide-btn.prev');
        const nextBtn = document.querySelector('.slide-btn.next');

        let isDragging = false;
        let startX = 0;
        let currentTranslate = 0;
        let prevTranslate = 0;
        let animationID;
        let sliderWidth = 0;
        let containerWidth = 0;

        // ì´ˆê¸° ì„¤ì •
        window.addEventListener('load', () => {
        sliderWidth = sliderTrack.scrollWidth;
        containerWidth = sliderTrack.parentElement.offsetWidth;
        });

        sliderTrack.addEventListener('mousedown', dragStart);
        sliderTrack.addEventListener('touchstart', dragStart);

        sliderTrack.addEventListener('mouseup', dragEnd);
        sliderTrack.addEventListener('touchend', dragEnd);

        sliderTrack.addEventListener('mouseleave', dragEnd);

        sliderTrack.addEventListener('mousemove', dragMove);
        sliderTrack.addEventListener('touchmove', dragMove);

        function dragStart(e) {
        isDragging = true;
        startX = getPositionX(e);
        sliderTrack.classList.add('dragging');
            animationID = requestAnimationFrame(animation);
        }

        function dragEnd() {
        isDragging = false;
        prevTranslate = currentTranslate;
        sliderTrack.classList.remove('dragging');
        cancelAnimationFrame(animationID);
        checkBounds();
        }

        function dragMove(e) {
        if (!isDragging) return;
        const currentPosition = getPositionX(e);
        const diff = currentPosition - startX;
        currentTranslate = prevTranslate + diff;
        }

        function getPositionX(event) {
        return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
        }

        function animation() {
        setSliderPosition();
        if (isDragging) requestAnimationFrame(animation);
        }

        function setSliderPosition() {
        sliderTrack.style.transform = `translateX(${currentTranslate}px)`;
        }

        // ê²½ê³„ ì²´í¬ (ìŠ¬ë¼ì´ë”ê°€ ë„ˆë¬´ ì¢Œìš°ë¡œ ì›€ì§ì´ì§€ ì•Šê²Œ ì œí•œ)
        function checkBounds() {
        if (currentTranslate > 0) {
            currentTranslate = 0;
        }
        if (Math.abs(currentTranslate) > sliderWidth - containerWidth) {
            currentTranslate = -(sliderWidth - containerWidth);
        }
        prevTranslate = currentTranslate;
        setSliderPosition();
        }

        // ì¢Œìš° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        prevBtn.addEventListener('click', () => {
        currentTranslate += 160; // í•œ ì¹¸ì”© ì´ë™ (ì•„ì´í…œ ë„ˆë¹„ + gap)
        if (currentTranslate > 0) currentTranslate = 0;
        prevTranslate = currentTranslate;
        setSliderPosition();
        });

        nextBtn.addEventListener('click', () => {
        currentTranslate -= 160;
        if (Math.abs(currentTranslate) > sliderWidth - containerWidth) {
            currentTranslate = -(sliderWidth - containerWidth);
        }
        prevTranslate = currentTranslate;
        setSliderPosition();
        });
    });

    let frm = {};
    $(document).ready(function() {
        //ê²€ìƒ‰í•„í„° ì ìš©
        $(document).on("click", ".btn-apply-filter", function () {
            frm = $("#searchFrm").serialize();

            // ì•„ì´ì½˜ ë³€ê²½
            $("#filterBtn img").attr("src", "/static/images/home/icon_filter_on.png");

            // íŒì—… ë‹«ê¸°
            $(".modal").hide();
            $("body").removeClass("modal-open");
        });

        //ê²€ìƒ‰ë²„íŠ¼ í´ë¦­
        $('#filterBtn').on('click', function(){
            SearchFilterModal('modal-filter', 'filterBtn', frm);
        });
    });
</script>
{% endblock script %}
{% block body %}
<div id='header_bg'>
    <div clss='main-header-area'>
    </div>
</div>
<header class="r_header">
    <h1 class="r_logo">ğŸ½ï¸ ë¯¸ì‹ ê°€ì´ë“œ</h1>

    <div class="r_search-box">
        {% comment %} <a class="filter-icon-button" data-toggle="modal" data-target="#modal-filter" onclick="SearchFilterModal('modal-filter',frm);"> {% endcomment %}
        <a class="filter-icon-button" data-toggle="modal" data-target="#modal-filter" id="filterBtn">
            <img src="/static/images/home/icon_filter_off.png" alt="í•„í„° ì•„ì´ì½˜">
        </a>
        <input type="text" placeholder="ìŒì‹ì  ì´ë¦„ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”">
        <button onclick="searchData();">ê²€ìƒ‰</button>
    </div>
</header>
<div class="home-container">
<div class="drag-slider">
  <button class="slide-btn prev">&lt;</button>
  <div class="slider-container">
    <div class="slider-track">
        {% for loc in locationDetail %}
        <div class="slide-item">
            <a class="slide-item" href="/restaurants/reslist?locno={{ loc.location.locno }}&locdno={{ loc.locdno }}">
                {{ loc.locd_nm }}
            </a>
        </div>
        {% endfor %}
    </div>
  </div>
  <button class="slide-btn next">&gt;</button>
</div>
<div class="food-container">
    <ul class="food-grid">
        {% for food in foodType %}
        <li>
            <a href="/restaurants/reslist?ftypeno={{ food.ftypeno }}" class="food-item">
                <div class="food-img">
                    <img src="{{ food.img_url_main }}" alt="{{ food.ftype }}">
                </div>
                <span class="food-name">{{ food.ftype }}</span>
            </a>
        </li>
        {% endfor %}
    </ul>
</div>
</div>
<!-- Modal Body -->
<form id="searchFrm" name="searchFrm">
    <div id="modal-filter" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modalTitle"></div>
</form>
{% endblock body %}